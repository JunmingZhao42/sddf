/*
 * Helper functions/macros for pancake to access
 * the shared memory and network queues and buffers
 *
 * Can't use shape/struct at the moment since it's in shared memory
*/

/*
typedef struct net_buff_desc {
    // offset of buffer within buffer memory region or io address of buffer
    uint64_t io_or_offset;
    // length of data inside buffer
    uint64_t len;
} net_buff_desc_t;
*/
#define NET_BUFF_DESC_SIZE  (2 * @biw)

/*
typedef struct net_queue {
    // index to insert at
    uint64_t tail;
    // index to remove from
    uint64_t head;
    // flag to indicate whether consumer requires signalling
    uint64_t consumer_signalled;
    // buffer descripter array
    net_buff_desc_t buffers[];
} net_queue_t;
*/

// Note: net_queue structs are typically stored in shared memory throughout sDDF

#define get_tail(tail, queue)   \
    var tail = 0;               \
    !ldw tail, queue;           \

#define set_tail(tail, queue)   \
    !stw queue, tail;           \

#define get_head(head, queue)       \
    var head = 0;                   \
    !ldw head, queue + @biw;        \

#define set_head(head, queue)       \
    !stw queue + @biw, head;        \

#define buffer_addr_idx(index, queue)  (queue + 3 * @biw + index * NET_BUFF_DESC_SIZE)

